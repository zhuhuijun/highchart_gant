<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>甘特图的制作</title>
    <link rel="stylesheet" href="app/js/bootstrap/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="app/js/ztree/css/zTreeStyle/zTreeStyle.css"/>
    <script src="app/js/jquery/dist/jquery.min.js"></script>
    <script src="app/js/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="app/js/highcharts/highcharts.src.js" type="text/javascript"></script>
    <script src="app/js/ztree/js/jquery.ztree.core-3.5.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        // Define tasks
        var tasks = [{
            name: '小任务1',
            intervals: [{ // From-To pairs
                from: Date.UTC(2016, 5, 16, 0, 0, 0),
                to: Date.UTC(2016, 5, 16, 6, 0, 0),
                label: '开始阶段'

            }, {
                from: Date.UTC(2016, 5, 16, 12, 0, 0),
                to: Date.UTC(2016, 5, 16, 16, 0, 0),
                label: '进攻阶段'
            }]
        }, {
            name: '小任务2',
            intervals: [{ // From-To pairs
                from: Date.UTC(2016, 5, 16, 6),
                to: Date.UTC(2016, 5, 16, 8)
            }, {
                from: Date.UTC(2016, 5, 16, 16),
                to: Date.UTC(2016, 5, 16, 22)
            }]
        }, {
            name: '小任务3',
            intervals: [{ // From-To pairs
                from: Date.UTC(2016, 5, 16, 7),
                to: Date.UTC(2016, 5, 16, 8),
                label: 'Breakfast'
            }, {
                from: Date.UTC(2016, 5, 16, 16),
                to: Date.UTC(2016, 5, 16, 17),
                label: 'Dinner'
            }]
        }, {
            name: '小任务4',
            intervals: [{ // From-To pairs
                from: Date.UTC(2016, 5, 16, 8),
                to: Date.UTC(2016, 5, 16, 16)
            }]
        }];

        // Define milestones
        var milestones = [{
            name: 'Get to bed',
            time: Date.UTC(2016, 5, 16, 22),
            task: 1,
            marker: {
                symbol: 'triangle',
                lineWidth: 1,
                lineColor: 'black',
                radius: 8
            }
        }];

        // re-structure the tasks into line seriesvar series = [];
        var series = [];
        $.each(tasks.reverse(), function (i, task) {
            var item = {
                name: task.name,
                data: []
            };
            $.each(task.intervals, function (j, interval) {
                item.data.push({
                    x: interval.from,
                    y: i,
                    label: interval.label,
                    from: interval.from,
                    to: interval.to
                }, {
                    x: interval.to,
                    y: i,
                    from: interval.from,
                    to: interval.to
                });

                // add a null value between intervals
                if (task.intervals[j + 1]) {
                    item.data.push(
                            [(interval.to + task.intervals[j + 1].from) / 2, null]
                    );
                }

            });

            series.push(item);
        });

        // restructure the milestones
        $.each(milestones, function (i, milestone) {
            var item = Highcharts.extend(milestone, {
                data: [[
                    milestone.time,
                    milestone.task
                ]],
                type: 'scatter'
            });
            series.push(item);
        });

        //
        var setting = {
            data: {
                key: {
                    title: "t"
                },
                simpleData: {
                    enable: true
                }
            },
            callback: {
                beforeClick: beforeClick,
                onClick: onClick
            }
        };

        var zNodes = [
            {id: 1, pId: 0, name: "普通的父节点", t: "我很普通，随便点我吧", open: true},
            {id: 11, pId: 1, name: "叶子节点 - 1", t: "我很普通，随便点我吧"},
            {id: 12, pId: 1, name: "叶子节点 - 2", t: "我很普通，随便点我吧"},
            {id: 13, pId: 1, name: "叶子节点 - 3", t: "我很普通，随便点我吧"},
            {id: 2, pId: 0, name: "NB的父节点", t: "点我可以，但是不能点我的子节点，有本事点一个你试试看？", open: true},
            {id: 21, pId: 2, name: "叶子节点2 - 1", t: "你哪个单位的？敢随便点我？小心点儿..", click: false},
            {id: 22, pId: 2, name: "叶子节点2 - 2", t: "我有老爸罩着呢，点击我的小心点儿..", click: false},
            {id: 23, pId: 2, name: "叶子节点2 - 3", t: "好歹我也是个领导，别普通群众就来点击我..", click: false},
            {id: 3, pId: 0, name: "郁闷的父节点", t: "别点我，我好害怕...我的子节点随便点吧...", open: true, click: false},
            {id: 31, pId: 3, name: "叶子节点3 - 1", t: "唉，随便点我吧"},
            {id: 32, pId: 3, name: "叶子节点3 - 2", t: "唉，随便点我吧"},
            {id: 33, pId: 3, name: "叶子节点3 - 3", t: "唉，随便点我吧"}
        ];

        var log, className = "dark";
        function beforeClick(treeId, treeNode, clickFlag) {
            className = (className === "dark" ? "" : "dark");
            showLog("[ " + getTime() + " beforeClick ]&nbsp;&nbsp;" + treeNode.name);
            return (treeNode.click != false);
        }
        function onClick(event, treeId, treeNode, clickFlag) {
            showLog("[ " + getTime() + " onClick ]&nbsp;&nbsp;clickFlag = " + clickFlag + " (" + (clickFlag === 1 ? "普通选中" : (clickFlag === 0 ? "<b>取消选中</b>" : "<b>追加选中</b>")) + ")");
        }
        function showLog(str) {
            if (!log) log = $("#log");
            log.append("<li class='" + className + "'>" + str + "</li>");
            if (log.children("li").length > 8) {
                log.get(0).removeChild(log.children("li")[0]);
            }
        }
        function getTime() {
            var now = new Date(),
                    h = now.getHours(),
                    m = now.getMinutes(),
                    s = now.getSeconds();
            return (h + ":" + m + ":" + s);
        }
        //
        $(function () {
            $('#container').highcharts({
                title: {
                    style: {fontSize: '16px', fontWeight: 'bold', textTransform: 'uppercase'},
                    text: '作战任务--甘特图'
                },

                xAxis: {
                    type: 'datetime',
                    opposite: true,
                    labels: {
                        style: {
                            color: "#000",
                            font: 'bold 11px "Trbuchet MS",Verdana,sans-serif'
                        }
                    },
                    title: {
                        style: {
                            color: '#333',
                            fontWeight: 'bold',
                            fontSize: '12px'
                        }
                    }
                },

                yAxis: {
                    tickInterval: 1,
                    labels: {
                        style: {
                            color: '#000',
                            font: 'bold 11px "Trbuchet MS",Verdana,sans-serif'
                        },
                        formatter: function () {
                            if (tasks[this.value]) {
                                return tasks[this.value].name;
                            }
                        }
                    },
                    gridLineWidth: 1,
                    lineColor: '#FF00',
                    lineWidth: 1,
                    tickWidth: 1,
                    tickColor: '#000',
                    startOnTick: false,
                    endOnTick: false,
                    title: {
                        text: ''
                    },
                    minPadding: 0.2,
                    maxPadding: 0.2
                },

                legend: {
                    enabled: false
                },

                tooltip: {
                    formatter: function () {
                        return '<b>' + tasks[this.y].name + '</b><br/>' +
                                Highcharts.dateFormat('%H:%M', this.point.options.from) +
                                ' - ' + Highcharts.dateFormat('%H:%M', this.point.options.to);
                    }
                },

                plotOptions: {
                    line: {
                        lineWidth: 15,
                        marker: {
                            enabled: false
                        },
                        dataLabels: {
                            enabled: true,
                            align: 'left',
                            formatter: function () {
                                return this.point.options && this.point.options.label;
                            }
                        }
                    }
                },

                series: series,
                background2: '#F0F0EA'
            });

            $.fn.zTree.init($("#treeDemo"), setting, zNodes);

        });

        // create the chart

    </script>
</head>
<body>
<div class="container mycss" style="margin-top: 20px;">
    <div class="row">
        <div class="col-sm-2 col-xs-4 col-md-2 col-lg-3">
            <div class="panel panel-default" style="min-width: 200px;">
                <div class="panel-heading">
                    <h3 class="panel-title text-center">任务树菜单</h3>
                </div>
                <div class="panel-body" >
                    <ul id="treeDemo" class="ztree" style="min-height: 400px;"></ul>
                </div>
            </div>

        </div>
        <div class="col-sm-10 col-xs-8  col-md-10 col-lg-9">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title text-center">图表展示</h3>
                </div>
                <div class="panel-body">
                    <div id="container" style="min-width:400px;height:500px;"></div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>